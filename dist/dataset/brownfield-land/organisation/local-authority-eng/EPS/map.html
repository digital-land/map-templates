<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" crossorigin="" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" crossorigin="" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar@0.2.2/src/L.Control.Sidebar.css" crossorigin="" />

<style>
  body {
    margin: 0;
  }

  #map {
    width: 960px;
    height: 640px;
    transform: translate(-50%,-50%);
    position: absolute;
    top: 50%;
    left: 50%;
  }

  .leaflet-sidebar {
    display: none;
    width: 200px;
  }

  .leaflet-sidebar.visible {
    display: block;
  }

  .leaflet-sidebar .close {
    z-index: 10000;
  }

  .leaflet-marker-icon.marker-cluster {
    line-height: 18px;
    text-align: center;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    background: #fff;
    border: 2px solid #222;
  }
</style>

<div id="map"></div>
<div id="sidebar"></div>

<script>
  var geoJson = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"objectid":214,"lad19cd":"E07000208","lad19nm":"Epsom and Ewell","lad19nmw":" ","bng_e":521176,"bng_n":161475,"long":-0.26172,"lat":51.339451,"st_areashape":34079152.96163566,"st_lengthshape":28503.700859809775},"geometry":{"type":"Polygon","coordinates":[[[-0.2459557867822199,51.38014410874447],[-0.24608771245440494,51.380189236223295],[-0.246493930256732,51.38016295034999],[-0.2466022066982458,51.380150995880996],[-0.2468162384943001,51.38011553993882],[-0.24719916414461995,51.379985515614074],[-0.2475645928650704,51.38016179565035],[-0.24761873394209913,51.38017438226368],[-0.24766752043668253,51.380175111810146],[-0.24772380874617708,51.38016867114272],[-0.2477514712483353,51.380160993959144],[-0.24782335346912804,51.380121612876344],[-0.24789345017338163,51.380169410036494],[-0.24835032284208944,51.38005756938781],[-0.24863150748865454,51.380032104001366],[-0.2488445607689146,51.379984942685795],[-0.24907690676271596,51.37992278598453],[-0.24991763375540305,51.379618799117345],[-0.2505175708362612,51.379411901319706],[-0.2507844730398206,51.37930710427294],[-0.2509782159180868,51.37923798447221],[-0.2514521019225755,51.37909581822464],[-0.25163791383271816,51.37904824626293],[-0.2523492245235954,51.378896942388614],[-0.2527663128098701,51.37884922056471],[-0.2533977151465311,51.37879570170482],[-0.253580650476489,51.378783144950624],[-0.2539475509189099,51.3787715315316],[-0.25452537588911545,51.37876845193402],[-0.25506037308111723,51.378757540213016],[-0.25558735980115266,51.37876718484039],[-0.255755695767088,51.378761598900134],[-0.25629152084898166,51.37880373608899],[-0.25717505956825315,51.37884654818694],[-0.25727816248617325,51.37885527400045],[-0.2573639241263993,51.378868236439125],[-0.2574677642951379,51.37889495324292],[-0.2584206050378288,51.37896935294682],[-0.2593355211419253,51.37916913459485],[-0.25976963010820636,51.37924121064051],[-0.2598986568978773,51.37928807715268],[-0.2599939757596923,51.379314665164344],[-0.2601493616269704,51.3793475397189],[-0.26063651986816966,51.37949870488005],[-0.26081687187922853,51.379554423894994],[-0.26100631107735683,51.37959859045269],[-0.26110107676574,51.37959909744922],[-0.2611485618019616,51.37959980207462],[-0.26114200774872515,51.37946934623698],[-0.2613538622504686,51.37918741016708],[-0.2613956492424751,51.37910702849408],[-0.26141704536178584,51.379036323578696],[-0.2614680511874966,51.37852454790114],[-0.2614952966476029,51.378487103255374],[-0.2615668665400114,51.37841804104903],[-0.2618775683763287,51.378219471359635],[-0.2619133181219748,51.37818583890334],[-0.261945182724676,51.37814216951145],[-0.2619677598995889,51.37807777426538],[-0.2623874289549482,51.377353813028996],[-0.26246882939198435,51.37725343026896],[-0.262872930892066,51.377053455968266],[-0.2632752400111926,51.376825583262324],[-0.26383356495662796,51.37642561105037],[-0.26423459512022524,51.37608084401812],[-0.26467865173399646,51.37562244680774],[-0.26550378249846207,51.37523091383157],[-0.2664327273407648,51.3747941634523],[-0.266780935398708,51.37463020842456],[-0.2679860978765325,51.37406528500082],[-0.2688512950837396,51.37364015810459],[-0.2688864266707278,51.37362269700167],[-0.2692372203000898,51.373502825522614],[-0.26973562081550184,51.373316896485285],[-0.2704670136129068,51.3730875664835],[-0.271041741749693,51.372897274557424],[-0.2711799291869941,51.37285166524441],[-0.2719323319738047,51.37259566489389],[-0.27216734837458945,51.37249844031507],[-0.27242288051398866,51.372350184378156],[-0.2725454182510856,51.37226388701694],[-0.27257794212685105,51.37224009232011],[-0.27274759990692116,51.372123024588426],[-0.27295952655103173,51.37198760934835],[-0.27319862910056214,51.37185717868331],[-0.2732118718534928,51.37184838376785],[-0.27337106005268175,51.37174185861463],[-0.2734067288073892,51.37171001923709],[-0.27358877556811917,51.37153109986572],[-0.2737139933589179,51.371332373726446],[-0.273795827375876,51.371181644804366],[-0.27392298772471535,51.370972158425715],[-0.2739907833386982,51.37081034493363],[-0.27402255185322516,51.37065528310682],[-0.2742389855975413,51.37059194315484],[-0.27436500484131504,51.37056413093514],[-0.2746127477707783,51.37050925308773],[-0.27496147194027876,51.37040560612563],[-0.27497596538973523,51.37040132399651],[-0.27536373553071586,51.370251501733875],[-0.27539734077458305,51.3702367122076],[-0.27562670861931954,51.37013481291014],[-0.2758323913004649,51.37001377430439],[-0.2759630512322603,51.369903229584594],[-0.27597788303296117,51.36988996224495],[-0.2760975099378,51.36976406178348],[-0.2761080784628089,51.36975073171032],[-0.27618241500354146,51.36964484194965],[-0.27624373914444095,51.369465851021],[-0.276287891987348,51.36928669650763],[-0.2762841886662336,51.369268571979646],[-0.2762606344354923,51.36917023228917],[-0.2762701929260566,51.3690669858023],[-0.27640936948405254,51.368918807011056],[-0.27649953821061457,51.36885180707213],[-0.27656006262871163,51.368807746881444],[-0.27660821095995,51.368790473947776],[-0.2767901814955843,51.36872662326391],[-0.27697928559682655,51.36862412826234],[-0.27703646371351154,51.3685935032674],[-0.27724342749383324,51.3685138359565],[-0.27744827972813985,51.36845571447518],[-0.27752516002093247,51.368433469630865],[-0.27752669926397094,51.368433492255356],[-0.27789355608443694,51.368379548747136],[-0.27789939064450775,51.368378735211195],[-0.2779079812474697,51.36837706379839],[-0.2780423334945703,51.36835737178448],[-0.27845263693512495,51.36829777177826],[-0.27864422789150306,51.36824574561167],[-0.2789940093365589,51.36815109206323],[-0.27910721599975946,51.36812038958333],[-0.27941626838077027,51.36799987417188],[-0.2794804294609945,51.36797564363152],[-0.2798193888362887,51.36782508973629],[-0.280037990933836,51.3677032449224],[-0.28014068732061415,51.36764631534001],[-0.28046982467460224,51.36744787726976],[-0.2805316472985486,51.367410126275765],[-0.2805331024057068,51.36740924834922],[-0.28077868150966845,51.36725642217382],[-0.28081551098077456,51.36723448684851],[-0.2810333265932799,51.36709554908276],[-0.2811738735300526,51.36698613328876],[-0.28125477622009193,51.366897419519624],[-0.2813470969687404,51.366731468076985],[-0.28144764418348156,51.3666178700447],[-0.281462506989467,51.36660370336761],[-0.28161725218705835,51.36646294091121],[-0.2817895963114927,51.36631083844433],[-0.28188010490107884,51.36623125497444],[-0.2819663399075142,51.366155114111216],[-0.2821617814692816,51.365999754390614],[-0.282393944231912,51.36586012468737],[-0.28261283082446026,51.36573027998658],[-0.2828264459780438,51.36562732656607],[-0.2831033448753492,51.365523413195724],[-0.2832156075960144,51.36547651095757],[-0.2832550744735105,51.36546000845813],[-0.2834220603935909,51.36541300835308],[-0.28343364438640956,51.365410481128656],[-0.2836309341751395,51.365357632417734],[-0.28366294397285075,51.365347312722896],[-0.2837793196035345,51.365307573454956],[-0.28378667576412087,51.36530408501705],[-0.2839108723891519,51.36524836689391],[-0.2840108514625945,51.3651877995147],[-0.2840711290972952,51.3651500244681],[-0.2840814258101565,51.36514388216815],[-0.28435722780935757,51.36495184593654],[-0.2845725290767182,51.36480036882252],[-0.2847377577380754,51.36464806762725],[-0.2849055491518939,51.364538147460344],[-0.2850262187192303,51.36446259855786],[-0.28518999698457764,51.364383995282004],[-0.28543783445831944,51.36424917501065],[-0.2856373159431383,51.36409926288645],[-0.2857023767472077,51.36405067968013],[-0.28574525266184203,51.364018942430874],[-0.2859314484554878,51.36384096532646],[-0.28600292373985575,51.36377278724799],[-0.2863042201019276,51.36351279673324],[-0.28651072766661484,51.36329187358269],[-0.2866461755426886,51.36312475089601],[-0.28675695241298754,51.36296814481802],[-0.28681595801408516,51.36288809698873],[-0.286865789383006,51.3628222088291],[-0.28702095329319544,51.36266625144973],[-0.2871995485890132,51.36253940571094],[-0.28734875815319183,51.3624668784144],[-0.2874738281971813,51.36242555427306],[-0.2876829015450922,51.362367477711686],[-0.28789449702734143,51.36231483052548],[-0.2881305277179753,51.362264338488046],[-0.28815462937892383,51.36223412452879],[-0.28827820421067707,51.362080311718486],[-0.2879426718955136,51.361946851179255],[-0.28793702302295165,51.36194586937258],[-0.28759872328617503,51.36181047898068],[-0.2875718992180028,51.36179929934951],[-0.2872135564017876,51.36169966565878],[-0.28700315742051635,51.361640851544685],[-0.2869975421101667,51.361638970917525],[-0.28650018995077936,51.36149406060538],[-0.2861416158739024,51.36140071339297],[-0.28582328730988366,51.36134930844996],[-0.28540197215350155,51.361283809550734],[-0.28507723209459024,51.361210642765506],[-0.2853366168461648,51.36107059666513],[-0.28603064390440697,51.360295646059924],[-0.2863898487172482,51.35998435874471],[-0.2865879413399171,51.35979486727643],[-0.2866790501161201,51.35970180342877],[-0.28683355782167863,51.35952506968842],[-0.28697280374959727,51.359373284891596],[-0.2880738533725715,51.359042268655905],[-0.2889725408637446,51.35871008830176],[-0.28921220530838126,51.35844380101355],[-0.28934490524475986,51.358235374840454],[-0.28946273394133437,51.35807968173215],[-0.28958642355710773,51.35792236545134],[-0.2897709476820834,51.357711908295414],[-0.2898579011124796,51.357612490384895],[-0.29019931530280785,51.357278463224716],[-0.29059928363954796,51.35691103756313],[-0.29087472233951056,51.35668850922039],[-0.29091593445563274,51.35666303925363],[-0.2910848719980928,51.35655933223079],[-0.2911067134630337,51.35647514571396],[-0.2911797422276878,51.35609405004806],[-0.2911851577585025,51.35606626042156],[-0.2912191653232118,51.355884171189345],[-0.29122762243484956,51.35565675960549],[-0.29120050247823975,51.35530656755375],[-0.2912000657566916,51.355200479606296],[-0.29132280822090356,51.35495046168469],[-0.29147592851561455,51.354695492720346],[-0.2917011516245689,51.35443447215821],[-0.29197943068178184,51.35417323597076],[-0.29205721551644354,51.35412582353349],[-0.2922835760262656,51.35398699194736],[-0.2923962694086912,51.35389244116907],[-0.29250032443783214,51.35379767539861],[-0.2926608211212409,51.35361482113583],[-0.2927582873820909,51.35342646328892],[-0.2927487602810756,51.35290841545022],[-0.29275974920876713,51.35268913171512],[-0.29277587105120656,51.352605760625295],[-0.29279600661150973,51.35252595326183],[-0.2929065698813565,51.3523738359265],[-0.2931529670757799,51.35219573787874],[-0.29329548008943035,51.35210791316692],[-0.2934467844831355,51.35201931790307],[-0.2941485032097317,51.35164557266823],[-0.2943260736820489,51.35154468165761],[-0.2944953993763253,51.351432973811974],[-0.29481674266006896,51.35121011306134],[-0.29496730120528214,51.35109992906002],[-0.29524062930626227,51.35085299527377],[-0.2956142394739072,51.35053919548759],[-0.296015484239469,51.35025276960748],[-0.29645275028642976,51.349962370771145],[-0.29724430777057076,51.34956564386252],[-0.2975350560165098,51.34939447571424],[-0.29777111582503163,51.349261258215385],[-0.2977975985186593,51.34924636021239],[-0.2981348050444672,51.34905788582531],[-0.29839157441768166,51.348873726484776],[-0.29865034411168073,51.3486706262041],[-0.2989693201504247,51.34851065238545],[-0.29917564547215353,51.34836801095916],[-0.2994288398207193,51.34812347575754],[-0.29992527917749967,51.34766940975847],[-0.3000768253241085,51.34749351974199],[-0.30016034250689855,51.34737067109164],[-0.3002468675944869,51.347243281683554],[-0.3005237958083809,51.34678243407346],[-0.30064905939294,51.34654233440612],[-0.30076477598442325,51.34628501609642],[-0.30102191478329327,51.34574108404905],[-0.30115209974246904,51.3455182252216],[-0.30131409909500445,51.34529304144194],[-0.30152714270142583,51.34508657640848],[-0.3017669424130428,51.34488957738119],[-0.30192108038763793,51.344800025161156],[-0.30199730578496586,51.34475887687028],[-0.30228728165329105,51.34460395776087],[-0.3025127073911586,51.34444981084603],[-0.3032638268225243,51.343784472281634],[-0.30340758712862687,51.34366159502661],[-0.30367547043855186,51.34344423250681],[-0.30378253345612805,51.34334689443047],[-0.30387935692449025,51.34325111574717],[-0.30402467926901633,51.34304735142446],[-0.30412224785846,51.34281583708227],[-0.3041917086942199,51.342608189148585],[-0.30430530886364615,51.342368905158246],[-0.30437297657096607,51.34220977562785],[-0.3044378519482094,51.342046111280965],[-0.30449441760637025,51.341873426044025],[-0.30454530630957244,51.341700568740755],[-0.30459463270843734,51.34137755924688],[-0.3046400572317162,51.3411570675601],[-0.304730015088206,51.340858917880844],[-0.30478712553161,51.340713120381864],[-0.30491560617068814,51.34042002295475],[-0.3049870276810186,51.34027452133018],[-0.30506385317511225,51.34013979603664],[-0.3053173990491137,51.33972624520541],[-0.30541413159457104,51.33947853675512],[-0.3054155695026564,51.339205177455035],[-0.30535714794313223,51.33892115374472],[-0.30535587481826226,51.338682815625766],[-0.3052980483334399,51.338421185200865],[-0.30527253023858464,51.33821755602811],[-0.3052212701412959,51.33812781636983],[-0.3050564928989945,51.33788711404434],[-0.3049568775110436,51.33770587712902],[-0.30485942962598245,51.33754615697101],[-0.3049323711353891,51.33735932493309],[-0.30493711496451426,51.3370734276032],[-0.3049260949278443,51.33674954506725],[-0.30502890570867963,51.33645248010207],[-0.3051730597193697,51.33616410418681],[-0.30525545771548773,51.33603215610052],[-0.30568627731815856,51.33540711971676],[-0.3058642056312235,51.33525236971751],[-0.3060081127014976,51.335166349367654],[-0.30619199668051733,51.33508441267247],[-0.30613405875309957,51.33490287969422],[-0.30610590253166675,51.33465516326366],[-0.3059842735395774,51.33440969199557],[-0.3056107812004985,51.33379460403369],[-0.3054829158062105,51.33356432415516],[-0.3052685567815206,51.33326267254768],[-0.30500785177489154,51.33297572281186],[-0.30468708645476306,51.332680621689136],[-0.30424711388278924,51.33223537344841],[-0.3034336940298567,51.33147996272193],[-0.303170035514251,51.33123512761647],[-0.3025764080523634,51.330711233996844],[-0.3015560394397876,51.32981167136113],[-0.300861129228716,51.32919190616778],[-0.3001890618670724,51.3286174172988],[-0.2995734252595189,51.32803115721978],[-0.29897984579385967,51.32750814187598],[-0.2983292284892734,51.326898981846156],[-0.298150489561485,51.32672728684651],[-0.2980734571757201,51.32667582476528],[-0.29795681938872776,51.326568949654245],[-0.2978105672077567,51.326408513277705],[-0.29771870600372385,51.32625255286337],[-0.2974289838243536,51.32585980166164],[-0.29694328002183573,51.32579970323823],[-0.2963021150357057,51.325748129865],[-0.29598583187445826,51.325644642600544],[-0.29567629494937,51.32547733130018],[-0.29562490685107995,51.325468492972696],[-0.29557353648685647,51.325462351824584],[-0.2952890989491038,51.32546720397449],[-0.29512597086658693,51.32545584036471],[-0.29486723686322397,51.325466459385076],[-0.2946207079080437,51.32545747755282],[-0.29421929562212923,51.325403086526],[-0.2938343686036495,51.32529679089721],[-0.29357060416408776,51.32521014984333],[-0.29326444146616076,51.32522007446423],[-0.29298422818950487,51.32526732711245],[-0.29286632772082327,51.3252745994957],[-0.29275565585888635,51.32527838084762],[-0.2926172616742254,51.32525748458541],[-0.2925162092140809,51.32527309391221],[-0.2923615660596417,51.325262748378975],[-0.2923395867359118,51.32511849360103],[-0.2922782917485845,51.32491441983766],[-0.2917770422647209,51.32496105457265],[-0.29155737127105064,51.32496504314602],[-0.2913067867240181,51.324909245420315],[-0.2910431964427365,51.32481810510036],[-0.2908459368926776,51.32471903062176],[-0.2907399917672205,51.324633875368505],[-0.29053281822877436,51.32445455227413],[-0.29043158502751204,51.32436047519773],[-0.2903184152902547,51.324237363784775],[-0.2899979749042374,51.32386129696755],[-0.2897993702699259,51.3236839847386],[-0.2896336368415736,51.323510658338684],[-0.28942505240924826,51.323289957077584],[-0.28924866260875276,51.32313274696033],[-0.2890760711710662,51.322911671171234],[-0.289028479800236,51.322839052407865],[-0.28897112892695304,51.32264393332852],[-0.288923341699862,51.32254164486415],[-0.2887566007928215,51.32223973988631],[-0.2887047389817509,51.32212929988369],[-0.28868785843169387,51.322080504908186],[-0.2886522688806892,51.32187941017878],[-0.2886320659745332,51.321805394523444],[-0.28854111824810486,51.32166732168786],[-0.28842109487481665,51.32153790486662],[-0.28797869692808387,51.321276021841754],[-0.2876630534114855,51.32111857097378],[-0.2876602816794477,51.32111673185601],[-0.28729502746606755,51.32078854621167],[-0.2872076476491389,51.32059298619921],[-0.28714020727651207,51.32036085650268],[-0.28704522965781876,51.32013740495091],[-0.2869068387523656,51.31992311771189],[-0.28672947420023687,51.3195608166964],[-0.2866011211278407,51.319343978713896],[-0.2863747430923699,51.31891263265377],[-0.2863234185520678,51.318708608797856],[-0.28621382027786574,51.3185316010408],[-0.28610003252434374,51.31815584458526],[-0.2859714885471742,51.31790942371544],[-0.28592645269787037,51.317809780372954],[-0.28585110299945354,51.31759650296029],[-0.2856057362649457,51.317211536956115],[-0.28554248359711254,51.31709912863784],[-0.2855330017205525,51.317083706123825],[-0.28541402925403103,51.31673304428373],[-0.285194963033605,51.316258555992384],[-0.2851291980825793,51.316099361220886],[-0.2850705194594702,51.31590241950833],[-0.2849622089207672,51.31553573030669],[-0.2848404895090341,51.31495118634761],[-0.2848161661674319,51.314794395391104],[-0.2847976083399223,51.314638499187694],[-0.28479336574482444,51.31452066169824],[-0.2847918812857157,51.314408169610495],[-0.28480061715690924,51.31425006630477],[-0.28473257401241303,51.31407276629862],[-0.28465139288428604,51.31363544994722],[-0.284523666761067,51.313443789084744],[-0.28433803345062425,51.31326305736708],[-0.284292023383069,51.313037531171],[-0.28420539716505044,51.31285735126988],[-0.28402061602181505,51.31273318142614],[-0.2837549292853494,51.31258633692948],[-0.2834715041880723,51.31241396932073],[-0.28321625143130613,51.31229514687574],[-0.28298149894825175,51.31220080957434],[-0.28234553924131617,51.31186323640601],[-0.28220087407376215,51.31178019919669],[-0.28206500906727594,51.31169279536179],[-0.28149727340319,51.31129328466072],[-0.28140807263847234,51.31122355757421],[-0.28116238596994014,51.31100417860248],[-0.2810616245213684,51.310895622171714],[-0.2808938654064254,51.31062344421269],[-0.28075087370305934,51.31041986720992],[-0.2806045064087848,51.3100723931475],[-0.2804905173183432,51.30986204924175],[-0.2803890888067082,51.30961952471539],[-0.2802710205530807,51.309284153304596],[-0.2801897460257086,51.30896460613534],[-0.2800365717666759,51.308647602686534],[-0.2798840559757948,51.30842689549996],[-0.2798324613171702,51.30835142766636],[-0.2797776460457219,51.30832095343458],[-0.2797761088081369,51.30832093083813],[-0.2797242490287301,51.30829050092405],[-0.27953779757922975,51.30801885859344],[-0.27933347938709785,51.30757344050676],[-0.2792059269966551,51.307378183326236],[-0.2790537629897918,51.3070755781424],[-0.2789186535527681,51.30673456574299],[-0.2788488439856749,51.30652945846962],[-0.27878199657448777,51.30632430478392],[-0.2786822533433565,51.30596133623889],[-0.27855444693938014,51.30519770550177],[-0.27846616069000574,51.3045255472633],[-0.2782985511912459,51.30363726336136],[-0.27834665549615817,51.30346445821735],[-0.2784268301589712,51.30327854825352],[-0.2783967600166048,51.30300740657681],[-0.278385329058992,51.30269967893932],[-0.2782674838903102,51.30228340056134],[-0.2782068643175426,51.30213956267039],[-0.2781519135800401,51.302037073046826],[-0.2780879261667972,51.30194532915571],[-0.27801811289580286,51.30185439789186],[-0.2779188822958963,51.30174676190216],[-0.27768933043333804,51.30143942033087],[-0.276866440528406,51.300429110128945],[-0.27674458136519825,51.30031313991475],[-0.2766911912396489,51.3002449277071],[-0.2766391158964311,51.300141582105404],[-0.27660577904188616,51.29999904587436],[-0.2765697989613699,51.299923897602575],[-0.27653421153599006,51.29987932153028],[-0.27639266690367637,51.2997521834817],[-0.2761076640140025,51.299470098325614],[-0.2758602502549434,51.29914451533249],[-0.27573627895095154,51.29896827876168],[-0.2756125993131228,51.29878746188363],[-0.2753143499886778,51.29832268007315],[-0.2751510822283131,51.29804957940069],[-0.2749328497447186,51.2975580167445],[-0.27450677325447786,51.29667672135776],[-0.2741742954615505,51.296135016206016],[-0.27403186632546417,51.29591526370863],[-0.27399820920271,51.29585723091215],[-0.27395781308150974,51.29578651158645],[-0.27388315334213426,51.295636083352456],[-0.2738117659301127,51.29547410718899],[-0.273753333436749,51.29531043266113],[-0.2736823777047004,51.29498564995258],[-0.2736632316060818,51.29472995727838],[-0.273661160514569,51.294558213736714],[-0.27364241412777257,51.29444636961644],[-0.27360910813342615,51.29433799602105],[-0.2735777132063655,51.29425752093956],[-0.2735482451814999,51.29420134750448],[-0.27333334539370296,51.29385196630222],[-0.27299154456751334,51.29348084439654],[-0.27290245246684236,51.29337164867082],[-0.27283798309220036,51.293293381581655],[-0.2725879040171578,51.292923702680135],[-0.2724428913472382,51.29269761767759],[-0.27223435521324085,51.29233034886324],[-0.2718342800717486,51.29259513854657],[-0.27030782853962254,51.293752375241304],[-0.26997469598580937,51.2939911764194],[-0.26984864770979505,51.29410079105026],[-0.26977524333099795,51.294181606511096],[-0.2696480939353033,51.29436132801723],[-0.26955754798224746,51.29455516579563],[-0.26935631616777744,51.294795914383876],[-0.2693149769741278,51.29490138669407],[-0.269269598117679,51.29504195087293],[-0.26924369410212345,51.29512068128914],[-0.26921071263471313,51.29523346947043],[-0.2691887040283863,51.295362691284026],[-0.26916290107058327,51.2954387262442],[-0.26911798192116915,51.29552616546991],[-0.26904803856176257,51.29563121467085],[-0.26883431920549866,51.29589874737125],[-0.26833711527316306,51.296455254641245],[-0.2680065940021704,51.296890971724316],[-0.267924600120396,51.29704897484869],[-0.2677761866874213,51.29725903623869],[-0.26770412719342573,51.29734157819465],[-0.26758345017717494,51.29746205962736],[-0.2674556256272002,51.297580725665966],[-0.26728999381196394,51.29771402623591],[-0.266835720083959,51.298005866085724],[-0.2663794132605301,51.29831385626872],[-0.26537386551329006,51.2989599187659],[-0.26487573789864816,51.29931313317754],[-0.26470555072983876,51.29941318822199],[-0.26461347528590246,51.299458572223486],[-0.2644793162164282,51.29951591861377],[-0.26439931868903715,51.299545299108],[-0.2642044528140296,51.29957837163923],[-0.26407847033735404,51.29960707027163],[-0.26404106460805943,51.299611011206984],[-0.2639363482774313,51.29961215572735],[-0.2623319135724578,51.29943732514725],[-0.2607712107090577,51.29928550780705],[-0.26045424959623653,51.299247536931176],[-0.2603421527575355,51.29925306315004],[-0.26025452136606064,51.29933096415617],[-0.2601216655283251,51.29942878006749],[-0.2588191988254781,51.299429199775],[-0.2577224492951353,51.299372432181784],[-0.2569357214624767,51.29935263299923],[-0.2561323486863028,51.299316399317675],[-0.2542029969244997,51.2993892403099],[-0.2540691123649535,51.29940162798362],[-0.2539974097594167,51.299402357456565],[-0.2537699638172672,51.299383683077224],[-0.2535248701312826,51.299418684648245],[-0.25339109911427715,51.29935016296527],[-0.2532833471851784,51.29920381676211],[-0.25243356528491667,51.29940869700204],[-0.2516005010967757,51.29962469975469],[-0.2513412032756948,51.29950126357382],[-0.25063481997760606,51.29906711163434],[-0.2501392939649847,51.29878003454865],[-0.24989428945699535,51.29866040501635],[-0.2494369895232306,51.298578059658],[-0.24918166525301105,51.298540084008586],[-0.2487962765229978,51.298451528857335],[-0.24824110439350802,51.2983398472936],[-0.2474923568188141,51.298149662294875],[-0.24712633296213576,51.2980435000969],[-0.24716998954962996,51.298291469679974],[-0.24717338504600583,51.29838861317609],[-0.2471755110556097,51.29848492834756],[-0.2471337201433605,51.29867848971803],[-0.24710725451222915,51.298845398543435],[-0.24697842324952513,51.299175296057314],[-0.2468167350502514,51.299656633735296],[-0.24685072876348596,51.299779497025895],[-0.2468787405519624,51.2999848889823],[-0.24681979146207897,51.3005541586808],[-0.2468168189438607,51.300970451516044],[-0.24675970952605064,51.30133927636188],[-0.24665920997481106,51.30156792339508],[-0.2463785351804071,51.3022318787579],[-0.2460557032322369,51.30276034930733],[-0.24580076628143419,51.30320173070889],[-0.24546147296402226,51.30367142729751],[-0.24487806985300625,51.30444691272984],[-0.24430059248727135,51.30525565682478],[-0.24367533159806895,51.30611321924499],[-0.24331869695168848,51.306660955032406],[-0.2432515751017008,51.30680469206543],[-0.2432202800684045,51.306908599925215],[-0.2432055975505762,51.307029748631365],[-0.24320373667279624,51.30711872345875],[-0.24321380869171677,51.307192594725954],[-0.24325398005189883,51.30734252405236],[-0.24347117118282796,51.307779197494504],[-0.24380308602087594,51.30840557463138],[-0.24402867375216403,51.30877135015563],[-0.24410788251850424,51.308952434936394],[-0.2441290477043959,51.30903636419101],[-0.24413618335838994,51.30911289147237],[-0.2441294384913207,51.309174915304766],[-0.2441205954923763,51.309220635459646],[-0.2440268737496838,51.3094197219194],[-0.24387232459725858,51.309560446911775],[-0.24370002195593127,51.30967654140318],[-0.24328793341773758,51.30979542691265],[-0.24302799805170247,51.309913803518114],[-0.24277917629136792,51.31000447537731],[-0.24273849629030392,51.31009386114021],[-0.2428572382066354,51.310289837706904],[-0.24222248569819066,51.31019221386413],[-0.24188142907879265,51.31010528502612],[-0.24172094732890712,51.310026458714475],[-0.24121094089669742,51.30985329086674],[-0.2410294346641619,51.309798422558664],[-0.24073716705456583,51.310576397933296],[-0.24127305833407006,51.311344413325614],[-0.24143876452984311,51.3115527833475],[-0.24230252171895558,51.311478529323864],[-0.2440713008898059,51.31133961058448],[-0.24412855641644182,51.31138002646568],[-0.2441841974314952,51.31161461579676],[-0.24419353199755203,51.31185669261654],[-0.244272231240007,51.3122032001564],[-0.24440687165566455,51.31273314461439],[-0.24439499009061544,51.31300727007217],[-0.24422657022335956,51.31324758292692],[-0.24410029515737364,51.3134344940584],[-0.24364346131220022,51.314315291775706],[-0.24348442593751501,51.314495507752504],[-0.24317121502794553,51.314731761362644],[-0.24278334343050867,51.31507945684447],[-0.2423956223525982,51.31542616482684],[-0.24212567298086118,51.315691025619756],[-0.24151656644723066,51.316046995988565],[-0.24131431898967962,51.31615634454898],[-0.24119368282080644,51.31657268554775],[-0.24112555165227847,51.31692787032891],[-0.24110753651106864,51.317173042937306],[-0.24113992078493027,51.31730397933046],[-0.24180446203308784,51.31850095142911],[-0.24201410770258638,51.318836021599246],[-0.24200322911679026,51.319157803839076],[-0.24201255088221052,51.31944024274873],[-0.24219539044982114,51.32010225139235],[-0.24262811421207975,51.32075892903039],[-0.2427774422622202,51.32090771241218],[-0.242968399924459,51.32128017308981],[-0.242693112899289,51.32138671459501],[-0.24250030503473832,51.32147462473433],[-0.2423154525226366,51.32161749567147],[-0.2421353813875822,51.321783902388916],[-0.24195826877415078,51.32195026316019],[-0.2416698991138368,51.32224720272053],[-0.24132328725472313,51.322492020230115],[-0.24095704722074376,51.322723954954526],[-0.23978049239350596,51.32361636892196],[-0.23914655346354158,51.32397822685987],[-0.23864845759974337,51.324355610604044],[-0.23824241860067671,51.32453838772835],[-0.23790802017312598,51.32483731684129],[-0.23738531738330948,51.3252943356561],[-0.2369417309722688,51.325632072153255],[-0.2365413404870003,51.3259696478337],[-0.23604321681937662,51.326306557886404],[-0.23571106502651837,51.32650922652935],[-0.23532213531384055,51.32673270465995],[-0.23484491278127909,51.32693776910365],[-0.23433372542998238,51.327167400100706],[-0.23394840652405519,51.327296529869365],[-0.23389028254812946,51.32731543158003],[-0.23380984010660488,51.327354673618785],[-0.23374595503496196,51.32737258904114],[-0.2336709226435911,51.327384942317146],[-0.23315245798032347,51.32750486759085],[-0.232543562567322,51.32762513364012],[-0.231921547815541,51.32774789529096],[-0.2309442502520424,51.3279292041184],[-0.23071420449421728,51.327977870676655],[-0.23041433724781601,51.328047955969694],[-0.2298328159799919,51.32816691321827],[-0.2295814678453711,51.3282062652698],[-0.22840194456751595,51.328460011815295],[-0.22803555210805346,51.32854256967954],[-0.22598760747378513,51.32897921861401],[-0.22545486736079656,51.32909700598372],[-0.22473618220025762,51.329233547176955],[-0.22435078709118783,51.32932668393165],[-0.22331969725624862,51.32952320590251],[-0.2230039714155494,51.32959581933908],[-0.2220109415007356,51.32977492744295],[-0.22131778608485236,51.32984449829033],[-0.2209424814898049,51.32986306854617],[-0.22149144549475835,51.330403722886636],[-0.22214384670844298,51.331015261422564],[-0.22309459926695366,51.331747388906294],[-0.22412951596040595,51.33245552375785],[-0.2257042661651498,51.333462307541836],[-0.22697719525420132,51.334326046977175],[-0.22689423884118545,51.334393115588085],[-0.22734498442883846,51.33465355688896],[-0.22827146721065064,51.335235854407344],[-0.22870109419220203,51.335525637783064],[-0.2292053234371932,51.335888469589214],[-0.22978529845294962,51.336485379690664],[-0.22982268234697123,51.336522805485394],[-0.22845204250828968,51.337070428709076],[-0.22831347287730233,51.33712766654975],[-0.2282492579065195,51.33715375469783],[-0.22845966974848578,51.33724414401475],[-0.22785873907809637,51.33748866146213],[-0.22696044145119515,51.33781317870105],[-0.22682685344220807,51.33788847129693],[-0.22665290746643899,51.33808011400608],[-0.22615729495065465,51.33853658788527],[-0.22565472226003447,51.338946205327105],[-0.22442685634454748,51.339845754964244],[-0.2240905650206138,51.3400412244131],[-0.2236764509533156,51.33998369656581],[-0.22326112111111188,51.33988110852146],[-0.22227676187133827,51.34046059496008],[-0.2224890369232006,51.340689562194605],[-0.22270038156493654,51.34082942176409],[-0.22178593651971723,51.34134523667611],[-0.22106501008387633,51.34168409163244],[-0.2203817262973271,51.34201362425308],[-0.21979076778822257,51.34233107222285],[-0.21918052119132478,51.34262664747856],[-0.21836721793570196,51.34297765638741],[-0.21726442553420766,51.34338709172203],[-0.21740205643040947,51.343650892538044],[-0.2174558059835991,51.343782068408764],[-0.21771695208620398,51.34441733617232],[-0.2176840365493516,51.34445099764172],[-0.21777035818339488,51.344853454971975],[-0.2179900458586069,51.345593275543486],[-0.21777747301198955,51.34563139441373],[-0.21803529709292913,51.34598332954153],[-0.2181438394019261,51.34610913677922],[-0.21815745894220517,51.34612732422182],[-0.21836035347429572,51.34644875488772],[-0.2185930540569223,51.34692976429728],[-0.21871997480659863,51.34724734011123],[-0.21874695239614514,51.34729360097955],[-0.21883965784882953,51.347421862125394],[-0.218929870455901,51.34764798939869],[-0.21929066554275473,51.348380153094084],[-0.21943454260339088,51.348633166674006],[-0.21973404541488079,51.349092802729054],[-0.21986210072963794,51.349421182453106],[-0.2198888704218257,51.34947283362831],[-0.22011271134126853,51.349920529561416],[-0.22018551426332986,51.350079863303534],[-0.22022732075567955,51.350186582420456],[-0.22024129382052943,51.35023543200996],[-0.22024107067658735,51.35031454136791],[-0.22018949583184816,51.350386578131314],[-0.2202580076738864,51.350693373574074],[-0.22034281735265956,51.3509860305614],[-0.22042086214607826,51.35141972879496],[-0.22128708712984302,51.35133849161968],[-0.22126196491273942,51.35117080469931],[-0.22209185368952344,51.351324638660515],[-0.22205463562788608,51.351395994091405],[-0.2220020116002033,51.351531933657945],[-0.22196490893637283,51.35174713249345],[-0.22193731701539976,51.35190323043548],[-0.2219435480212177,51.352115490010426],[-0.22196442227490706,51.35235323484723],[-0.22197063418327695,51.35267616192896],[-0.22204925012226362,51.352722305737174],[-0.22204431979604342,51.352776261329595],[-0.22196776680584543,51.35282364522771],[-0.22195613846995893,51.35290078287975],[-0.2219512075929804,51.35306792332399],[-0.22195579840894353,51.353246086671206],[-0.2219748662922562,51.353530551304345],[-0.22200706064170103,51.35377565924362],[-0.22208935499696308,51.35409704395367],[-0.22213555800042045,51.354350455925726],[-0.22218271453614194,51.354505800627955],[-0.22224758911912057,51.35464702953002],[-0.22241507046940456,51.35507138408321],[-0.22241898303522695,51.355080433368066],[-0.22247678718052902,51.35525751536694],[-0.2225844600390641,51.355740296262574],[-0.2226782692867794,51.356211088975094],[-0.2227227840642139,51.35643480715698],[-0.2227816206767428,51.35665874249796],[-0.22278200251252434,51.3567621337042],[-0.22272644806251748,51.35701040551953],[-0.22273642831104426,51.35708607328021],[-0.22276461806001888,51.35709818760979],[-0.22285008467109452,51.357117464486805],[-0.22286381529075242,51.357132955661456],[-0.22295615607453823,51.35738167173238],[-0.22313156207916326,51.35774851779747],[-0.22317866307415712,51.35783203048748],[-0.223202135780048,51.35789261976407],[-0.2232216903468431,51.35798101772683],[-0.22327477574117127,51.3581302482383],[-0.2234600523492765,51.3584288291278],[-0.22362232577545743,51.35865163455793],[-0.22382734367111945,51.358960491637745],[-0.22405787543918657,51.3592742268085],[-0.2242380669093491,51.359444259547395],[-0.22431240471989417,51.35945437557187],[-0.22440448550033848,51.35956005375717],[-0.22449647608104115,51.35967112418929],[-0.22469529220949402,51.35995381201554],[-0.22492372438299024,51.3602486346012],[-0.22542470075184345,51.36081557282053],[-0.2261448391959052,51.36165741010742],[-0.22628262595737328,51.36177276807263],[-0.22634461771164585,51.36184202918364],[-0.22640677860168887,51.36194374667513],[-0.2264383440762067,51.362018841181595],[-0.22667526385774772,51.362318282718],[-0.22687296235617968,51.362593758075576],[-0.22694212817319068,51.36262447048565],[-0.22851663330902888,51.36332809236072],[-0.22990508201028226,51.36401719524059],[-0.22998247796126708,51.36405881830476],[-0.23045643643224578,51.364358235183886],[-0.23158338061551423,51.36508831890233],[-0.23174385990304347,51.36517173923258],[-0.2318899998835085,51.36525844831487],[-0.2320368547217909,51.36536045066024],[-0.23280807458827465,51.36581546010656],[-0.23319134576574574,51.366010024636616],[-0.2338195725242084,51.36532349460981],[-0.23394940095651193,51.365384783625764],[-0.23416395732714199,51.3654851062799],[-0.23522601394219572,51.365957965885634],[-0.23588878456156698,51.36635729460256],[-0.23677981233474155,51.366796912175296],[-0.23705172501717117,51.366899981519616],[-0.23740941478896235,51.366937725075],[-0.23782476875551203,51.36700689990794],[-0.238566491545745,51.36707198804336],[-0.2389174463096392,51.366834445774735],[-0.23947529970427656,51.36690045120995],[-0.24052727949095154,51.36700165245766],[-0.24089087845286952,51.36703677732837],[-0.2410774475110446,51.366476629910885],[-0.24115034006948746,51.366261966551846],[-0.24123176147538494,51.36627307648751],[-0.24295960616311182,51.3665102543089],[-0.2445907479463037,51.36671818003908],[-0.2451292203079993,51.366801758968876],[-0.24540484104760654,51.36684544069971],[-0.24532866900663086,51.36699452167082],[-0.2452929285260577,51.36706500746473],[-0.24501711974524046,51.36774250650277],[-0.2448792380256858,51.368154976610356],[-0.2447452895303224,51.368690760293305],[-0.24470703826848686,51.36897886034388],[-0.24467937272078405,51.36906115456434],[-0.2446320274309286,51.369249328146886],[-0.2446208443848419,51.36931568775392],[-0.24460337402296026,51.36943499483657],[-0.24458155217416847,51.36970536087461],[-0.2445378452529142,51.37047093462744],[-0.24458471973966012,51.370899656883836],[-0.24468313590216034,51.37137149413143],[-0.24468827299043697,51.371497432887274],[-0.24468035128133023,51.3716303684048],[-0.2447087228821919,51.37231700906038],[-0.244708842675773,51.372878085017426],[-0.2446993239774079,51.37301558106236],[-0.2446721445733702,51.37316261191269],[-0.24459959114814495,51.37317950513719],[-0.24460065772749315,51.373790130549835],[-0.2446368610506916,51.3744237567731],[-0.24471788728690547,51.3744456482568],[-0.24473973242203478,51.37451259154624],[-0.24476692497686298,51.37481785388269],[-0.24476444473903106,51.37495716392443],[-0.24476995118944178,51.37500219728166],[-0.24480017937997658,51.375113318630675],[-0.24483019123677016,51.375192880469456],[-0.24484139416867115,51.375274858396416],[-0.24491606485245085,51.37561499529527],[-0.24494457007155007,51.37584566236735],[-0.24505868372703896,51.37631944878226],[-0.2451132643977487,51.376658388487165],[-0.24517344394341584,51.37711437511485],[-0.24518343235431908,51.3771909419524],[-0.24517823290807034,51.37744178133393],[-0.24520669713830257,51.378349591409275],[-0.24516094417172135,51.379060213598166],[-0.24512107056843105,51.379424709863635],[-0.24503025472336548,51.38003396554783],[-0.24550504081971417,51.38005815689344],[-0.24556376285718975,51.37998801272819],[-0.2459557867822199,51.38014410874447]]]}}]}
  var organisations = [{"organisation":"local-authority-eng:EPS","wikidata":"Q73072619","name":"Epsom and Ewell Borough Council","website":"https://www.epsom-ewell.gov.uk","twitter":"","statistical-geography":"E07000208","toid":"","opendatacommunities":"http://opendatacommunities.org/id/district-council/epsom-and-ewell","opendatacommunities-area":"http://opendatacommunities.org/id/geography/administration/nmd/E07000208","billing-authority":"E3632","census-area":"43UC","local-authority-type":"NMD","esd-inventories":"","start-date":"","end-date":""}]
  var brownfield = [{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"148","site-address":"The Epsom Club, Church Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.332553","longitude":"-0.261282","hectares":"0.14","minimum-net-dwellings":"20","maximum-net-dwellings":"20","start-date":"2017-11-30","end-date":"","notes":"\"Site forms part of an allocation in Plan E, an Area Action Plan for Epsom Town Centre, and is the subject of a Development Brief. http://www.epsom-ewell.gov.uk/sites/default/files/documents/residents/planning/planning-policy/Upper%20High%20Street%2C%20depot%20Road%20and%20Church%20Street%20Dev%20Breif%20Nov%202012.pdf. Comprehensive redevelopment of the wider site could increase the dwelling yield. Site is labelled as 148A on the Map of Brownfield Sites\"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"186","site-address":"31 to 37 East Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.33588","longitude":"-0.26308","hectares":"0.29","minimum-net-dwellings":"30","maximum-net-dwellings":"30","start-date":"2017-11-17","end-date":"","notes":"\"Site forms part of a larger site allocated in Plan E, the Area Action Plan for Epsom Town Centre. http://www.epsom-ewell.gov.uk/sites/default/files/documents/residents/planning/planning-policy/Plan%20E%20final%20version.pdf. Comprehensive redevelopment of the wider site could increase the dwelling yield. Site is labelled as 186A on the Map of Brownfield Sites \"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"194","site-address":"Etwell House and former coach depot, Station Approach","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.345142","longitude":"-0.241938","hectares":"0.19","minimum-net-dwellings":"10","maximum-net-dwellings":"10","start-date":"2017-11-09","end-date":"","notes":"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"20","site-address":"Epsom Baptist Church, Church Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.333297","longitude":"-0.26289","hectares":"0.23","minimum-net-dwellings":"41","maximum-net-dwellings":"41","start-date":"2017-11-28","end-date":"","notes":"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"21","site-address":"Rail Land, Mill Road","site-plan-url":"","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"51.336108","longitude":"-0.256596","hectares":"0.46","minimum-net-dwellings":"15","maximum-net-dwellings":"15","start-date":"2017-11-08","end-date":"","notes":". Permission is for the development of student accommodation (77 units) contained within 9 buildings","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"329","site-address":"King's Arms Public House, East Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.338104","longitude":"-0.25777","hectares":"0.14","minimum-net-dwellings":"12","maximum-net-dwellings":"12","start-date":"2017-11-13","end-date":"","notes":"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2018-05-22","entry-date":"2017-12-19","organisation":"local-authority-eng:EPS","site":"570","site-address":"Sunnybank House, 39a East Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.335995","longitude":"-0.2623","hectares":"0.1","minimum-net-dwellings":"10","maximum-net-dwellings":"10","start-date":"2017-11-17","end-date":"","notes":"","resource":"9f19704ae1cded4c413dd836183eef54a4cc124a4a13fe167132f956ddd6ab3f"},{"resource-date":"2019-12-14","entry-date":"2018-12-18","organisation":"local-authority-eng:EPS","site":"600","site-address":"Lower Mill, Kingston Road","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"pending decision","planning-permission-type":"","hazardous-substances":"","latitude":"51.355","longitude":"-0.252906","hectares":"0.55","minimum-net-dwellings":"53","maximum-net-dwellings":"53","start-date":"2018-12-04","end-date":"","notes":". Permission is being sought for 53 extra care apartments, C2 use class","resource":"a4a67c0666dfca856013c465b4be6974ff7228a32088c7fdb3cd608de93c1ccb"},{"resource-date":"2019-12-14","entry-date":"2018-12-18","organisation":"local-authority-eng:EPS","site":"601","site-address":"Spread Eagle Shopping Centre, High Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"51.333146","longitude":"-0.2667","hectares":"0.18","minimum-net-dwellings":"35","maximum-net-dwellings":"35","start-date":"2018-12-04","end-date":"","notes":"","resource":"a4a67c0666dfca856013c465b4be6974ff7228a32088c7fdb3cd608de93c1ccb"},{"resource-date":"2019-12-14","entry-date":"2018-12-18","organisation":"local-authority-eng:EPS","site":"602","site-address":"Haddad House, 91 East Street","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"reserved matters approval","hazardous-substances":"","latitude":"51.338148","longitude":"-0.258328","hectares":"0.05","minimum-net-dwellings":"5","maximum-net-dwellings":"5","start-date":"2018-11-27","end-date":"","notes":"","resource":"a4a67c0666dfca856013c465b4be6974ff7228a32088c7fdb3cd608de93c1ccb"},{"resource-date":"2019-12-14","entry-date":"2018-12-18","organisation":"local-authority-eng:EPS","site":"603","site-address":"Aviary Court, 138 Miles Road","site-plan-url":"","deliverable":"","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"planning permission granted under an order","hazardous-substances":"","latitude":"51.339314","longitude":"-0.266037","hectares":"0.07","minimum-net-dwellings":"8","maximum-net-dwellings":"8","start-date":"2018-12-04","end-date":"","notes":". Prior approval permitted for COU of B1 floorspace to 8 residential units","resource":"a4a67c0666dfca856013c465b4be6974ff7228a32088c7fdb3cd608de93c1ccb"},{"resource-date":"2019-12-20","entry-date":"2019-12-10","organisation":"local-authority-eng:EPS","site":"1317","site-address":"Maplins, 42 High Street, Epsom","site-plan-url":"","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"pending decision","planning-permission-type":"","hazardous-substances":"","latitude":"54.526982","longitude":"-5.697314","hectares":"0.3","minimum-net-dwellings":"9","maximum-net-dwellings":"9","start-date":"2019-12-11","end-date":"","notes":"Submitted application, pending decision for 9 units on upper floors.","resource":"7054465d8c8c10a3d45508912b91518e9635f1165be87050db8efbb9d77eb444"},{"resource-date":"2019-12-20","entry-date":"2019-12-10","organisation":"local-authority-eng:EPS","site":"535","site-address":"Former Police and Ambulance Station, Church Street","site-plan-url":"","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"pending decision","planning-permission-type":"","hazardous-substances":"","latitude":"54.529224","longitude":"-5.700749","hectares":"0.37","minimum-net-dwellings":"33","maximum-net-dwellings":"33","start-date":"2019-11-12","end-date":"","notes":"Submitted application, pending decision for 60 extra care apartments (the 33 units yield is derived from the Housing Delivery Test Measurement Rule Book). Site forms part of the Emergency Services Site allocation in the Area Action Plan – Plan E","resource":"7054465d8c8c10a3d45508912b91518e9635f1165be87050db8efbb9d77eb444"},{"resource-date":"2019-12-20","entry-date":"2019-12-10","organisation":"local-authority-eng:EPS","site":"565","site-address":"The Wells Centre, Spa Drive","site-plan-url":"","deliverable":"yes","ownership":"owned by a public authority","planning-permission-status":"pending decision","planning-permission-type":"","hazardous-substances":"","latitude":"54.510789","longitude":"-5.707766","hectares":"0.32","minimum-net-dwellings":"23","maximum-net-dwellings":"23","start-date":"2019-12-04","end-date":"","notes":"Submitted application, pending decision for 23 units.","resource":"7054465d8c8c10a3d45508912b91518e9635f1165be87050db8efbb9d77eb444"},{"resource-date":"2019-12-20","entry-date":"2019-12-10","organisation":"local-authority-eng:EPS","site":"893","site-address":"57 Salisbury Road, Worcester Park","site-plan-url":"","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"pending decision","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"54.531439","longitude":"-5.633128","hectares":"0.27","minimum-net-dwellings":"13","maximum-net-dwellings":"13","start-date":"2019-11-06","end-date":"","notes":"Submitted application, pending decision for 15 units. Site already has approval for 13 units.","resource":"7054465d8c8c10a3d45508912b91518e9635f1165be87050db8efbb9d77eb444"},{"resource-date":"2019-12-24","entry-date":"2019-10-15","organisation":"local-authority-eng:EPS","site":"16/23671/FUL","site-address":"St John’s Church, Stone","site-plan-url":"https://www.staffordbc.gov.uk/brownfield-land-register","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.16","minimum-net-dwellings":"9","maximum-net-dwellings":"9","start-date":"2019-10-15","end-date":"","notes":"Conversion of Church and erection of rear two-storey extension (following demolition of existing single-storey extension) to provide five residential units and the erection of a 2.5 storey building fronting The Avenue to provide four apartments on the former Church car park","resource":"0a2acb3630049c97f654ba03d73bd03261a00ec702ff5e8403433afef412e84f"}]
</script>

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet-sidebar@0.2.2/src/L.Control.Sidebar.js" crossorigin=""></script>
<script src="https://unpkg.com/papaparse@5.1.1/papaparse.min.js" crossorigin=""></script>

<script>
var map = L.map('map', {
  preferCanvas: true,
  fullscreenControl: true
}).setView([52.561928, -1.464854], 7)

// Tile layers
L.tileLayer('https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
  id: 'base',
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map)

// Sidebar
var sidebar = L.control.sidebar('sidebar', {
  position: 'right'
})

map.addControl(sidebar)

// Brownfield Features
var brownfieldFeatures = brownfield.map(function (point) {
  return {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [point.longitude, point.latitude]
    },
    properties: point
  }
})

// Local authority boundaries (England only)
geoJson = geoJson.features.filter(function (item) {
  return item.properties.lad19cd.startsWith('E')
}).map(function (item) {
  var lad19cd = item.properties.lad19cd
  if (item.properties.lad19cd === 'E06000057') {
    // Northumberland
    lad19cd = 'E06000048'
  } else if (item.properties.lad19cd === 'E07000240') {
    // St Albans
    lad19cd = 'E07000100'
  } else if (item.properties.lad19cd === 'E07000241') {
    // Welwyn Hatfield
    lad19cd = 'E07000104'
  } else if (item.properties.lad19cd === 'E07000242') {
    // East Hertfordshire
    lad19cd = 'E07000097'
  } else if (item.properties.lad19cd === 'E07000243') {
    // Stevenage
    lad19cd = 'E07000101'
  } else if (item.properties.lad19cd === 'E08000037') {
    // Gateshead
    lad19cd = 'E08000020'
  }

  item.properties.organisation = organisations.find(function (organisation) {
    if (organisation['statistical-geography'] && organisation['statistical-geography'].length) {
      return organisation['statistical-geography'].toString().toLowerCase() === lad19cd.toString().toLowerCase()
    }
  })

  return item
})

L.geoJSON(geoJson, {
  style: {
    fillOpacity: 0,
    weight: 2,
    color: 'gray'
  },
  onEachFeature: function (feature, layer) {
    if(organisations.length === 1) {
      map.fitBounds(layer.getBounds())
    }

    if (!feature.properties.organisation) {
      layer.setStyle({
        fillColor: 'red',
        fillOpacity: 0.25
      })
    } else {
      var thisOrganisationsFeatures = brownfieldFeatures.filter(function (brownfieldFeature) {
        if (brownfieldFeature.properties.organisation.toLowerCase() === feature.properties.organisation.organisation.toLowerCase()) {
          return true
        }
        return false
      })

      var brownfieldMarkers = L.markerClusterGroup({
        showCoverageOnHover: false,
        zoomToBoundsOnClick: false,
        spiderfyOnMaxZoom: false,
        removeOutsideVisibleBounds: true,
        animate: false,
        disableClusteringAtZoom: 11,
        maxClusterRadius: 600,
        singleMarkerMode: false
      })
      var brownfieldOnMap = L.geoJSON({
        type: 'FeatureCollection',
        features: thisOrganisationsFeatures
      }, {
        pointToLayer: function (feature, latlng) {
          var size = isNaN(feature.properties.hectares) ? 100 : (Math.sqrt((feature.properties.hectares * 10000) / Math.PI))
          return L.circle(latlng, { color: 'red', fillColor: '#f03', fillOpacity: 0.5, radius: size.toFixed(2) })
        },
        onEachFeature: function (feature, layer) {
          layer.on({
            click: function () {
              sidebar.setContent('<h2>Loading...</h2>')
              sidebar.show()

              return Papa.parse('https://raw.githubusercontent.com/digital-land/map/master/docs/data/brownfield/' + feature.properties.organisation.toLowerCase().replace(':', '-') + '.csv', {
                download: true,
                header: true,
                complete: function (results) {
                  var point = results.data.find(function (row) {
                    return (row.latitude === feature.properties.latitude.toString()) && (row.longitude === feature.properties.longitude.toString())
                  })

                  if (point) {
                    content = ''

                    Object.keys(point).forEach(function (key) {
                      content = content + key + ': ' + point[key] + '<br>'
                    })
                  } else {
                    content = '<h2>Point not found - debug info:</h2><pre>' + JSON.stringify(results.data) + '</pre><h3>Looking for a row with latitude, longitude:</h3>' + feature.properties.latitude.toString() + ',' + feature.properties.longitude.toString()
                  }

                  sidebar.setContent(content)
                }
              })
            }
          })
        }
      })

      brownfieldMarkers.addLayer(brownfieldOnMap)
      map.addLayer(brownfieldMarkers)
    }

    layer.on({
      mouseover: function () {
        this.setStyle({
          fillColor: 'black',
          fillOpacity: 0.25
        })
      },
      mouseout: function () {
        this.setStyle({
          fillColor: 'white',
          fillOpacity: 0
        })
      },
      click: function () {
        return map.fitBounds(layer.getBounds())
      }
    })
  }
}).addTo(map)
</script>
