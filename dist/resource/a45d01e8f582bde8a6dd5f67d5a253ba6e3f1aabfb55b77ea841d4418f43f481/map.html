<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" crossorigin="" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.css" crossorigin="" />
<link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar@0.2.2/src/L.Control.Sidebar.css" crossorigin="" />

<style>
  body {
    margin: 0;
  }

  #map {
    width: 960px;
    height: 640px;
    transform: translate(-50%,-50%);
    position: absolute;
    top: 50%;
    left: 50%;
  }

  .leaflet-sidebar {
    display: none;
    width: 200px;
  }

  .leaflet-sidebar.visible {
    display: block;
  }

  .leaflet-sidebar .close {
    z-index: 10000;
  }

  .leaflet-marker-icon.marker-cluster {
    line-height: 18px;
    text-align: center;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    background: #fff;
    border: 2px solid #222;
  }
</style>

<div id="map"></div>
<div id="sidebar"></div>

<script>
  var geoJson = {"type":"FeatureCollection","features":[{"type":"Feature","properties":{"objectid":161,"lad19cd":"E07000138","lad19nm":"Lincoln","lad19nmw":" ","bng_e":496347,"bng_n":370096,"long":-0.55848,"lat":53.219212,"st_areashape":35690272.57292394,"st_lengthshape":32969.876597357244},"geometry":{"type":"Polygon","coordinates":[[[-0.5383997335019579,53.25454873671245],[-0.5385806959481025,53.25456263449267],[-0.5386270246637566,53.25456679643558],[-0.5389295495750434,53.25457499225238],[-0.5393365186876992,53.25455031316283],[-0.5399860047086219,53.25445220841875],[-0.5402299558771859,53.25442014105574],[-0.540736857736918,53.254367920892896],[-0.5410818906404538,53.25431452926105],[-0.5415072756018746,53.25423884206304],[-0.5429015291563499,53.254100386196974],[-0.5438626837219321,53.2540464150825],[-0.5444394876459165,53.25396627294222],[-0.544778366098348,53.25391917658506],[-0.5469637435833192,53.25352420627521],[-0.5476417744727923,53.25337778733894],[-0.5477112271862369,53.253363354173025],[-0.5481390676330891,53.25329845752239],[-0.5482206846856353,53.25327877998541],[-0.5487163509007527,53.253159794546804],[-0.5492658138971628,53.253046943472704],[-0.552069064361618,53.252596386742574],[-0.5526619944031794,53.25248404688194],[-0.5531985132435491,53.252395285423056],[-0.5536591376259314,53.25233975391587],[-0.5541398572833789,53.252263703341434],[-0.5546636300573562,53.252153212244586],[-0.5546923179410534,53.25214906555645],[-0.5547720811686019,53.25213655099802],[-0.554866554053062,53.252270701903555],[-0.555424186813202,53.252178591966825],[-0.5575206826474787,53.25183717431688],[-0.558626639986177,53.25166440699381],[-0.5591798456995875,53.25161895775649],[-0.5594116936666884,53.25158940225361],[-0.5604785146586657,53.25146656301723],[-0.5610800025166144,53.251363181828495],[-0.5617279638668543,53.25125954922124],[-0.5621426268183413,53.25118455792351],[-0.5628397230214428,53.25104906749946],[-0.5630271712975096,53.25100189492514],[-0.5632741705386809,53.25096622247558],[-0.563554333967664,53.250925556500974],[-0.5639735906331753,53.25084603126227],[-0.5643848493939125,53.25073953672744],[-0.5651458978810837,53.25061657455598],[-0.565156459170738,53.25061490443925],[-0.5655874852608288,53.250545400852104],[-0.5662607809638127,53.25044474323253],[-0.5665474097269734,53.25039156608624],[-0.567031585177385,53.25029941946071],[-0.5677233017533038,53.25018720186074],[-0.5683976044578952,53.250055989086285],[-0.5692374994250714,53.24990599961943],[-0.5696314909494865,53.24981995230072],[-0.57000745008671,53.24973728263583],[-0.5702695342164384,53.249700879322326],[-0.570798328640644,53.249619048698015],[-0.5714408123328805,53.24950002181859],[-0.5719437620960334,53.24942964965792],[-0.5723454793705484,53.249382240437185],[-0.5725074909885781,53.249333850645094],[-0.5726517358819729,53.24927716028984],[-0.5734788069900111,53.24914774772931],[-0.5736964583757532,53.24909462928993],[-0.5740954444344234,53.24903999176941],[-0.5743758210311884,53.24899211431709],[-0.5746380709021572,53.24894671575101],[-0.576230915499285,53.248687037757634],[-0.5769501857482252,53.248554518686504],[-0.5773079737064625,53.2484787097543],[-0.5776959762530747,53.24839346295637],[-0.5776974594347192,53.24839348062811],[-0.5782762532003769,53.24829343029439],[-0.5790623031558109,53.248181375743606],[-0.5794609189397236,53.248092655617114],[-0.5803155913311886,53.24794555111408],[-0.581900474549718,53.24765155262604],[-0.5826238074079256,53.24753333794142],[-0.5836908647868261,53.24735278299112],[-0.584153139745387,53.247285382492734],[-0.5840870894629827,53.247197425761016],[-0.5848087462786072,53.247084659983756],[-0.585890523721907,53.24691046105964],[-0.5865147142391657,53.246841465353775],[-0.587346505481412,53.24674975898431],[-0.5874999226715232,53.24673261195485],[-0.5875239750636625,53.2467302006044],[-0.5875038590437327,53.24665806703704],[-0.5874889678136029,53.24661115877405],[-0.5875040015577127,53.24660864070933],[-0.588751747377462,53.246403128334464],[-0.5893535581710656,53.24628532237996],[-0.5904639183954855,53.24610872482471],[-0.5915536527429708,53.245920279815216],[-0.5928070456233101,53.245718386705384],[-0.5932884080808396,53.245618014504515],[-0.5935310493311783,53.24557773565048],[-0.5939485991245108,53.24550527739008],[-0.5945363909927167,53.245403457798716],[-0.594831183427851,53.245325147078276],[-0.5951119243720567,53.24517019101723],[-0.5948425764660942,53.24502233075614],[-0.5943489842861422,53.244809729834124],[-0.5920166824029508,53.24391113683935],[-0.5914409671965423,53.24369045595294],[-0.5893729058158216,53.24291355586846],[-0.5880911145033278,53.242429192496616],[-0.5857648556183521,53.24153503965278],[-0.5814348895521225,53.23987991905352],[-0.5801103497923622,53.2393786873819],[-0.5786715335673079,53.23884471313741],[-0.5780216576878923,53.23860681284005],[-0.5780201748512888,53.238606795168565],[-0.5762727661575818,53.23793601440485],[-0.573861855211776,53.23703520586567],[-0.5721957076940852,53.23644711478244],[-0.5723504816940735,53.23620991058183],[-0.5723931049319186,53.23614292812895],[-0.5724141186953705,53.23582674473014],[-0.5724147088783219,53.235719805492735],[-0.5723605442536478,53.23545394816054],[-0.5722665019631507,53.235083364083195],[-0.5720848542390364,53.234237931385756],[-0.5720835522822255,53.23423252380438],[-0.5720537305082307,53.234092866684534],[-0.5719338680061824,53.23373365594055],[-0.5718329933334908,53.23334222515553],[-0.5718036986060991,53.23323133270448],[-0.5716565631067964,53.23256703526503],[-0.5714569194457981,53.231814033922895],[-0.5713318953757806,53.23129109926696],[-0.5711404859416477,53.2306064978832],[-0.5710796596520045,53.23027405191331],[-0.5710517946765263,53.230164882447674],[-0.5709938976206618,53.23005993695849],[-0.5707271900241951,53.22961178442631],[-0.5721205721977709,53.23019206501723],[-0.5729181345501313,53.230534228011784],[-0.5742429754088897,53.231104762957614],[-0.5751555940274059,53.23150580308863],[-0.5754749218428693,53.231635527960925],[-0.5760572693413161,53.23146624425179],[-0.5775435742983748,53.23096443421648],[-0.5779755664349897,53.23085895519704],[-0.5782798048791249,53.23076552076937],[-0.578281317159579,53.23076464072676],[-0.5788365450478349,53.230600413055804],[-0.5801315200655411,53.230399249086844],[-0.5809110067943837,53.23029609898941],[-0.5829054261357259,53.23000967173693],[-0.5836452565059811,53.22992499493075],[-0.5845540964850741,53.22980547401537],[-0.5854665197087462,53.22966702179937],[-0.5867025695170144,53.229524396804806],[-0.5875909388510788,53.22938833702875],[-0.5885414969940325,53.22927286909942],[-0.5903872868953611,53.22904116557811],[-0.5912371530600881,53.22889213325228],[-0.5914960663211185,53.228853759738904],[-0.5919976932616359,53.22876621574323],[-0.5925076021403275,53.22870482916581],[-0.5929205944982022,53.22862702053933],[-0.5932686715019116,53.228566328142186],[-0.5936885467663514,53.22841400509027],[-0.5940945454045312,53.22823266950135],[-0.5950357357881674,53.227850934311455],[-0.5954643033951562,53.22835404067771],[-0.5964772167387581,53.22935300448707],[-0.5969944941232336,53.22897525313014],[-0.5973882956611046,53.22870568958115],[-0.5975670496693921,53.228598958630705],[-0.5986649420949244,53.227960122527854],[-0.599166216783666,53.22770080286243],[-0.5996137974178546,53.2274364478961],[-0.6000721530975471,53.22720897436168],[-0.6008121694582843,53.22683921355003],[-0.6013858520947484,53.22647190336554],[-0.6016199385764446,53.22632276730559],[-0.6016386984108809,53.22625109149044],[-0.6017870162668998,53.226206098099205],[-0.6018217843586058,53.226196619864325],[-0.6022292249252403,53.22592001255364],[-0.602590611606799,53.22567701564436],[-0.6028800791387556,53.22548440130894],[-0.6031167646694925,53.225342483180484],[-0.6033454169681771,53.225177912338054],[-0.6043211917327727,53.224879193034475],[-0.6047984948417254,53.224758959214164],[-0.6052408144659265,53.22474615801331],[-0.6055419370840183,53.2246048990702],[-0.60593917349225,53.224550227771175],[-0.6063792721411999,53.22432791030465],[-0.6065635961579071,53.22423480134824],[-0.6066917897997941,53.22416260600216],[-0.6068154714180819,53.22408855989993],[-0.6070575279926368,53.22387560842317],[-0.6073083064186928,53.22362591272312],[-0.6078469985549004,53.223135130249815],[-0.6084386093185454,53.22258106591085],[-0.6085745268803037,53.22245314874121],[-0.609835471340061,53.223528679581854],[-0.6101202012969466,53.2238016979668],[-0.6104744917775616,53.224100689669],[-0.611078526009422,53.223811065161826],[-0.6121033469942536,53.22334111231878],[-0.6130836937589206,53.222851761960605],[-0.6135666691345164,53.222646183008656],[-0.6142806114737064,53.222290417602736],[-0.6146171284242615,53.222168419392084],[-0.6152421638082701,53.22201481117729],[-0.6156663931571358,53.22191090416847],[-0.6156550081858807,53.22124106135942],[-0.6156543944778402,53.22121409363968],[-0.616939344753623,53.22089639431892],[-0.6169877042963725,53.22088257545901],[-0.6165157576216074,53.220095053611544],[-0.6160520834726476,53.21928506893877],[-0.6161621997874452,53.21925938533949],[-0.6167009955004362,53.21913253894182],[-0.62204042376221,53.21773272905398],[-0.6224040936363375,53.21764796076312],[-0.6226169743047587,53.21759820659336],[-0.6219756565301787,53.21732657728338],[-0.6216191404929875,53.2171884598222],[-0.6212283569710488,53.217044642018145],[-0.6206325960148049,53.21684713336889],[-0.6203192259614863,53.216719483603256],[-0.6195912709631519,53.2161177239406],[-0.6187708268066747,53.21545916849231],[-0.6179334289655344,53.21476805897159],[-0.6175748232230456,53.214512172692565],[-0.617468709704001,53.214410196700356],[-0.6174085770311638,53.214325919523525],[-0.6174343252139897,53.21412850075223],[-0.6175332999537082,53.21352103742067],[-0.6175985013956314,53.21289251324836],[-0.6176207686751942,53.21271114108025],[-0.6176760056577355,53.21239174780155],[-0.617708566308904,53.211986715354996],[-0.6177741725112272,53.21162520291407],[-0.6177917127760987,53.21131076560379],[-0.6179112177401886,53.210625261742045],[-0.6186911349651022,53.20951422527444],[-0.6192260417661456,53.20880666004186],[-0.6192747620147642,53.20873523700417],[-0.6197149775805747,53.20808409227048],[-0.6197353736939403,53.20805646744874],[-0.6196001923008102,53.20802165060782],[-0.6182206638159268,53.20757240340918],[-0.6176415445802654,53.20737597785968],[-0.6175903389290466,53.20733674063695],[-0.6172822264292172,53.207094023200426],[-0.6164020792211825,53.206435669462756],[-0.6149549654662294,53.20534015769885],[-0.6148791351408701,53.205279872709156],[-0.6148109383667781,53.205212576193595],[-0.6147853286749981,53.205076572908965],[-0.6148284584586047,53.2048073694368],[-0.6150207644209604,53.2039052249273],[-0.6150383863226125,53.20373018026772],[-0.6150293691657813,53.20354664762968],[-0.6146367172659116,53.20327777845587],[-0.6144070700823393,53.20311064841084],[-0.6137734333816224,53.20270497957654],[-0.6120209740168606,53.202400529346605],[-0.6107447147972673,53.20218976044545],[-0.6089177623866965,53.2018808027475],[-0.6085214573611415,53.20186719601977],[-0.608124658948476,53.20186886023251],[-0.6074855276486072,53.20190903696499],[-0.6070597274450538,53.20192563725774],[-0.6067081600138827,53.2019637726654],[-0.6060964038770524,53.202130171314224],[-0.6058758919182083,53.202192302745075],[-0.6056546714540864,53.20227240039995],[-0.6054228435841865,53.202355968675384],[-0.6048155860447098,53.202524210261984],[-0.603752820382139,53.20283630657439],[-0.6028583943618051,53.203084759012256],[-0.6026575962198797,53.20313633113606],[-0.6022463290794697,53.20321419713255],[-0.6020275684995569,53.20326384977123],[-0.6011357515284618,53.20347718148528],[-0.6007961078015491,53.203516339133635],[-0.6004887634776945,53.20357573624831],[-0.599141982258679,53.20323451677738],[-0.5961517682285409,53.202508915543596],[-0.5943609032606025,53.20205817363469],[-0.5916722514584665,53.201412496866084],[-0.5893285935278629,53.200837342320405],[-0.5882159994016765,53.2005715683508],[-0.5880702906076622,53.20053929003528],[-0.5883734899996501,53.20033167991471],[-0.5890298782678627,53.19990428778108],[-0.5879908020693478,53.199313063423546],[-0.5871024990789544,53.198826155854505],[-0.586779891512062,53.19866677373091],[-0.5867701402175215,53.198644190692576],[-0.5867244214800926,53.198578044615715],[-0.5867072034712778,53.19855357528428],[-0.5856564286499587,53.198778481165384],[-0.5853747024314719,53.19887759540315],[-0.5851478276820189,53.19885513577822],[-0.58506280459776,53.198846939371215],[-0.5846967667676696,53.19896122814023],[-0.5844845041787674,53.19899744512824],[-0.5842992587494213,53.19903029648971],[-0.5842774231647961,53.1990111647643],[-0.5841772262402787,53.19891642167554],[-0.5841779651679984,53.19889396279431],[-0.5841770726207374,53.19883104315379],[-0.5840955438815397,53.19880671025713],[-0.5839784931302521,53.19877027210475],[-0.583907471770641,53.19865169925547],[-0.5838579385816529,53.19856654387918],[-0.5835365450918488,53.19864451170791],[-0.5834286148152547,53.19864601658415],[-0.5834172108744076,53.198628716528326],[-0.5832161053619187,53.19832607386455],[-0.5831746849420982,53.1982644700982],[-0.5832843858073549,53.19820915418513],[-0.5834835486648937,53.19816208988056],[-0.5835227398102191,53.19815266918761],[-0.5835303556712637,53.19815006360165],[-0.583497528105323,53.19810114374627],[-0.583410456968169,53.197971506277064],[-0.5834275991166622,53.19781443706149],[-0.5831251786475995,53.19736131689589],[-0.5829875113935848,53.19726891373265],[-0.5828943926560127,53.19709435950638],[-0.5828629326991964,53.197048960729205],[-0.5823001701534174,53.19718166585607],[-0.5816166337271896,53.19734609472999],[-0.5814474802286876,53.19739270353678],[-0.5813486518920867,53.19739152881151],[-0.5811511475747775,53.19738828196764],[-0.5808123412189136,53.19754152634322],[-0.5807562012134664,53.197563326416194],[-0.5806656683992532,53.19758381848876],[-0.5804479339355081,53.19742305799201],[-0.5802945784316933,53.197308805546065],[-0.5800759222565126,53.197172298062824],[-0.5797576547244191,53.19702103410736],[-0.5794135225241208,53.1968345017904],[-0.579403243324562,53.19682808851899],[-0.579401761885763,53.1968280708848],[-0.5787278126034343,53.19651889179205],[-0.5778034787308771,53.19608540075333],[-0.5782908262959031,53.19588171941969],[-0.578289251846353,53.19588080260298],[-0.5781141881768274,53.19578884618201],[-0.5770069762762324,53.19523175434816],[-0.5751087568277081,53.19428407056028],[-0.5743261805960242,53.1939142543394],[-0.5743508578682789,53.19389208143332],[-0.5748099836099375,53.19354158892036],[-0.5749896891811908,53.193403447717635],[-0.5743382566907529,53.19305047515156],[-0.5746453236517891,53.19277455664915],[-0.5751504701216023,53.192390461981766],[-0.5740937048012311,53.1918492203172],[-0.57447522452005,53.191583176418625],[-0.5736202247609439,53.1911846261413],[-0.5726988129313607,53.19076100998205],[-0.5718857589761677,53.19036384628929],[-0.5711310321068939,53.19001312020035],[-0.5709085025045333,53.18990979920715],[-0.5702100305151786,53.189578703568344],[-0.5698159400965962,53.189413110460706],[-0.5691304826394832,53.1890956441811],[-0.569193300272668,53.18900643651394],[-0.5685277480022323,53.188721559206016],[-0.5666559087297133,53.1878963329785],[-0.5655789592508514,53.18742664864704],[-0.5649713206014779,53.18716050348905],[-0.5647437815557135,53.187071397476736],[-0.564428804572543,53.18700289676861],[-0.5641409410433057,53.18697246702292],[-0.5638514784248105,53.186945613201345],[-0.5635792312391644,53.18689470022508],[-0.563336807997708,53.186848639208876],[-0.5631085342568317,53.1868297111537],[-0.5608732979857263,53.18667054017319],[-0.5590777598642555,53.18652572112776],[-0.558452498283411,53.186470527916335],[-0.5569240796472942,53.18643765205644],[-0.5551778194798477,53.18638414097888],[-0.5528434794142559,53.186326071072216],[-0.5527541955879963,53.18662165253071],[-0.5526510692194143,53.186972875669944],[-0.5525950836371569,53.1871699125831],[-0.5525867159592842,53.187198569917534],[-0.5525601247903025,53.18727373889625],[-0.552498908864218,53.18745013120198],[-0.5524553666774459,53.18776514089017],[-0.5523482210990145,53.188147679922004],[-0.5522555805582473,53.188142959599446],[-0.5522492633466798,53.18819500784275],[-0.5522432788033137,53.18824085903073],[-0.5521285769075494,53.188536131101614],[-0.5520896576356873,53.188669566146515],[-0.5519966154847891,53.1890765411166],[-0.5518613617912095,53.18945065003367],[-0.5512803180040308,53.19141688829641],[-0.5507283599716825,53.193225119199745],[-0.5502749633897773,53.194509699789286],[-0.5500886724270603,53.195196022702376],[-0.5499692130472859,53.19563143119223],[-0.5498307033635842,53.19614488512796],[-0.549572296943039,53.19710272858712],[-0.5495408457754124,53.197372947046816],[-0.5495340996420436,53.19743757249003],[-0.5495252113426738,53.19747790605536],[-0.5495197705735919,53.19750749670093],[-0.5495195585687654,53.19751378508469],[-0.5493913352614697,53.19812082920535],[-0.5492979465488771,53.19884782659467],[-0.5492505763121405,53.19927521416144],[-0.5491978591262507,53.19972940845929],[-0.5491398821913162,53.20047130461885],[-0.5491063696391552,53.20111005358209],[-0.5490778919488617,53.2015555526116],[-0.5490256185484771,53.202395471262584],[-0.5489814545695405,53.20348173315683],[-0.548899451399586,53.204803981807565],[-0.5488441630037075,53.20577696146798],[-0.5488397736423858,53.205863183753614],[-0.5483799830339384,53.20577670105149],[-0.5449449714816321,53.205474095535415],[-0.5449393851592915,53.205285209523346],[-0.5449089540213661,53.20507535031848],[-0.544859071659905,53.204958807567905],[-0.5448210875796519,53.204884650477666],[-0.5447552071583481,53.20479577291143],[-0.5446519799007146,53.20466141379809],[-0.5446012386533107,53.20461406156122],[-0.5445215743519403,53.20453490136041],[-0.5442853195902215,53.20439172794464],[-0.5441680543012183,53.20431839904684],[-0.5439356328316187,53.20419333543103],[-0.5436797562656288,53.20410114647006],[-0.5434241716829953,53.204044100032235],[-0.5432165578503563,53.20398494352355],[-0.5428591099378112,53.203928448347995],[-0.5421328178434288,53.20384587011524],[-0.5411741892809818,53.20372350643263],[-0.5408429458290155,53.2036879966503],[-0.5403821535811709,53.203766831310084],[-0.5396442104535273,53.20393672208329],[-0.5395763799678529,53.20395296568675],[-0.5396119569196889,53.20413772731378],[-0.539564463577811,53.2042566725184],[-0.5395349398799953,53.204333600083174],[-0.5393912415893933,53.204333635796154],[-0.5393978734948807,53.20457825537662],[-0.539615761343622,53.20521828933894],[-0.5397744722008078,53.20574705723608],[-0.5398282375872369,53.205970685326164],[-0.5398216972306832,53.20620696455551],[-0.5397947029940006,53.206693014982726],[-0.539759153362804,53.206903774943655],[-0.5397248691166183,53.20720810653828],[-0.5397384769703707,53.2073782189089],[-0.539810854185525,53.20754096332387],[-0.539841398263411,53.207699509416535],[-0.5398670091187943,53.20787246478295],[-0.5398671208237772,53.20800008312361],[-0.5398310346639832,53.20827024097257],[-0.5398205310611411,53.208314148957534],[-0.5398001501711023,53.20834355700071],[-0.5396539533815863,53.20854765924083],[-0.5394777553413889,53.20879542968747],[-0.5394602740232487,53.20882666987409],[-0.5393347551396201,53.20903991974117],[-0.5391093000312045,53.209414699608395],[-0.5390274274138528,53.209535110788735],[-0.5387527031105658,53.2097753800727],[-0.5384524768562652,53.21006117044995],[-0.5383334668978109,53.21012621521194],[-0.5382126833094558,53.210156188756436],[-0.53791093823943,53.21035208919311],[-0.537670561476944,53.210551348760646],[-0.5375496521704526,53.210672178668034],[-0.5373703364830646,53.2107931010959],[-0.537190516900842,53.21088525861026],[-0.536925775066085,53.21114002643295],[-0.5367895604971772,53.211271452856245],[-0.5365822797015388,53.211466623244995],[-0.5363074531796274,53.21166554813249],[-0.5362094748730679,53.211725456666834],[-0.5361590061214336,53.21175719066636],[-0.5361545021551104,53.211758932395924],[-0.536119211120286,53.21178366282649],[-0.5360521350792575,53.21190425458459],[-0.5360074831514925,53.21198638637693],[-0.5358548194466045,53.212114824343274],[-0.5357403435757784,53.21222404925225],[-0.5356618038658177,53.21228599408385],[-0.5355777076172042,53.212337085830704],[-0.5350518653261012,53.21256078578839],[-0.5348100674885885,53.21262701401223],[-0.5346784608115281,53.21270987375263],[-0.5345891634200723,53.21282659522956],[-0.5344814991405382,53.21290974920338],[-0.5341975459505882,53.21306802376504],[-0.5338328966131295,53.21322090082711],[-0.5336490153263077,53.21329772343575],[-0.5334130635563143,53.21345667678663],[-0.5331342196678591,53.213595240073026],[-0.5328313028547209,53.21373719029716],[-0.532522708759646,53.21387179098203],[-0.5321903510584406,53.21400070622844],[-0.5319702366631285,53.21408975272107],[-0.5316346272794635,53.214179981849206],[-0.5312659022843431,53.21423475228555],[-0.53101717369729,53.214279317950975],[-0.5308180022515728,53.21432269616883],[-0.5305224025458186,53.21438384773512],[-0.5303929002216708,53.21440471851327],[-0.5300851387199321,53.21442788440292],[-0.52965508778816,53.21443426193884],[-0.529462828090351,53.21449569796836],[-0.5292608507260403,53.21457768361545],[-0.5287324149281607,53.2147455990153],[-0.5286839711649777,53.21476117775434],[-0.5288233445356049,53.21493185491277],[-0.5289640801874383,53.215152966125636],[-0.5290526675581179,53.21536444654776],[-0.5290067862598499,53.21539173997592],[-0.5290385606812955,53.21555659560303],[-0.5290383762909446,53.21556198530521],[-0.5289385535829334,53.21559229774248],[-0.5289067097233136,53.21560268951554],[-0.5290911077985235,53.21577482101222],[-0.5292935944355631,53.21598501095277],[-0.5293625124765244,53.21607123859776],[-0.5295681840587292,53.21631831398017],[-0.5297738731863209,53.2166552593211],[-0.5298582272482099,53.21677043575326],[-0.5299977088852676,53.21698523905503],[-0.5301118150802592,53.217107969196896],[-0.5302481710431941,53.21723735501553],[-0.5302974620687765,53.21728379558183],[-0.5303376577592562,53.21737955248411],[-0.5302839796105339,53.21746156930838],[-0.5302392066054076,53.217499750978305],[-0.5299603189159786,53.217595167836976],[-0.5298285585309586,53.21763847654767],[-0.5297847411220445,53.217652315625315],[-0.5295964116531795,53.217681446629165],[-0.5293600665882658,53.217717173820255],[-0.5292302157466293,53.21774792474078],[-0.5287547188961165,53.217858077472755],[-0.5283445467783284,53.217939288821256],[-0.5280233088480457,53.2180018256593],[-0.5276855262446252,53.218071436151874],[-0.5274367478606171,53.21816362484586],[-0.5273032856689857,53.21820960693769],[-0.527168556087738,53.218252876391354],[-0.5269603508695184,53.21829613762876],[-0.526960320126525,53.21829703530101],[-0.5268984785923194,53.218310650715814],[-0.5270890659247207,53.21860517111871],[-0.5271003940315785,53.21862418365726],[-0.5269152433535247,53.21874061317269],[-0.5266619799309311,53.21878691132665],[-0.5262504057153569,53.218865403213016],[-0.5260619767595535,53.218900818892934],[-0.5256723389574016,53.21895171981108],[-0.5252556029266476,53.21900417122437],[-0.5248434058676862,53.219057487384156],[-0.5243496742238912,53.219129563745],[-0.5238777293729474,53.21921808466652],[-0.5234725918176641,53.21928505354903],[-0.5225555425287755,53.21947140680031],[-0.5219737560014357,53.21953249694497],[-0.5212780282664627,53.2195994510484],[-0.5195545383105086,53.21975690520941],[-0.5186058707009499,53.21981701849395],[-0.517326048349448,53.21987938343292],[-0.516649307965442,53.219918594715665],[-0.5161460939019342,53.219957266626956],[-0.5154685120699344,53.220020725605245],[-0.5138233005929554,53.22021061016723],[-0.5137746694405033,53.219927719569505],[-0.5136811587693002,53.219424894682874],[-0.5134258963043574,53.2181038443913],[-0.5125961398239588,53.2181905528097],[-0.5118428163653458,53.218273806662914],[-0.511152177109612,53.21832269911553],[-0.5102000076055163,53.21826766252116],[-0.509577990641951,53.21823921602004],[-0.5089140707484511,53.21820844412466],[-0.507120004464274,53.219108330476146],[-0.5060319782833511,53.2196430000535],[-0.5054454814345164,53.21992781724672],[-0.5045114463121553,53.220166930632494],[-0.5038531310668457,53.2203609674236],[-0.5028549618759566,53.22063611041589],[-0.5012734800199824,53.221060285234124],[-0.5013567430627066,53.22129328969505],[-0.5014937527047402,53.22230453090152],[-0.5016128422036672,53.22284183847322],[-0.5016140425198,53.22284994155393],[-0.5017093538886922,53.22312353788977],[-0.5019371946115345,53.224278814839906],[-0.5021096444423578,53.2249578893593],[-0.5023006319973335,53.22579636571818],[-0.5010917631151829,53.2257047384899],[-0.4997846499134294,53.2256056506719],[-0.4959010872914147,53.22532474411053],[-0.4951184607327461,53.22525914565329],[-0.49512423164086505,53.22530595133515],[-0.4951964615704044,53.22594155124075],[-0.49534390103304105,53.22677860885611],[-0.49573592243307646,53.22880085943065],[-0.4958003447233062,53.22935996649016],[-0.49591915986792456,53.23071532006268],[-0.4962283828060462,53.232408389695436],[-0.49642380369013844,53.23371806241123],[-0.4946956490388618,53.23352093605505],[-0.493914707716645,53.23340323697562],[-0.4944665142825147,53.23535744065272],[-0.49472734438037347,53.23646736963274],[-0.49499183400636276,53.23738501089263],[-0.4952228829236275,53.23827706479885],[-0.4954793818702214,53.23912360290301],[-0.4957490155744142,53.24015634812286],[-0.4957674304495364,53.24018444159184],[-0.4957979166597914,53.2402135862258],[-0.4958671168718422,53.24024861109375],[-0.49628621456249783,53.24034745305839],[-0.4958793957484976,53.24092490105704],[-0.4955823155769239,53.2411063001457],[-0.4955471029390527,53.24112742627388],[-0.494342759455156,53.24184049927806],[-0.4943261177482117,53.2419310636011],[-0.4943262170457031,53.24201285146182],[-0.4943368766399729,53.242092974722866],[-0.49435727339243185,53.24215263907152],[-0.4943926797546073,53.242210604888086],[-0.4944343597419345,53.242262359525824],[-0.49473506727772226,53.24253496839135],[-0.495317808117061,53.243095136338106],[-0.4958138363545859,53.243824250610004],[-0.4954409597839705,53.24437335697436],[-0.4954361705825576,53.244379587808154],[-0.49535577528046887,53.244921506111645],[-0.4953872713998424,53.24492190328026],[-0.49556688841603946,53.24492686421607],[-0.4955609005154267,53.244970827270784],[-0.49551608830347665,53.24535061144723],[-0.4956776156903694,53.24596038022887],[-0.49578402575526265,53.246386917746094],[-0.4960121669810516,53.247190755815275],[-0.49634989003660485,53.24769219894533],[-0.4965674701382311,53.2479403885281],[-0.4975666147788711,53.24920079428265],[-0.49758922357936636,53.24919388878385],[-0.49904707868725945,53.24873842045018],[-0.500301326440081,53.248354037861894],[-0.5005939090677227,53.248264369048385],[-0.5016688557812969,53.24967578625647],[-0.5024331217973295,53.250581690370744],[-0.5024505628338639,53.250595390211856],[-0.5026816525625938,53.25054616465782],[-0.5043330186157367,53.25025762102208],[-0.5055023231226574,53.25003491118699],[-0.5062108696435172,53.249919754653924],[-0.5067519105033743,53.25017916397235],[-0.5074143514269152,53.250526361425365],[-0.5082870819698503,53.25094627898213],[-0.5098169375232393,53.25169353115791],[-0.5109307759481628,53.25225043847227],[-0.5119729768247467,53.25275701322196],[-0.5136017479095069,53.253553083339405],[-0.5138548130739272,53.25369014356375],[-0.5141644653476464,53.25379564454706],[-0.514189634724715,53.253804045990506],[-0.5143039629841094,53.253836025508214],[-0.5142945061000387,53.25398060124599],[-0.514872765941248,53.25398869795414],[-0.5159586250740055,53.253971650177036],[-0.5163651057930578,53.2539650203823],[-0.5175802817379539,53.25393608442316],[-0.5188449942528709,53.253904153473854],[-0.5202161306062011,53.2538753199046],[-0.5214335188618294,53.25386793375347],[-0.5231765047906943,53.25383288636153],[-0.5232755834058723,53.25383051773043],[-0.5232756995008199,53.25339266449008],[-0.5253669199543344,53.2536927092928],[-0.5257916473013061,53.25376266130664],[-0.5265080527606703,53.25385418668313],[-0.5274891391631736,53.253875367158145],[-0.5285931819755073,53.25389706598471],[-0.5292092115248084,53.25389926399871],[-0.5297533109649801,53.253897877107235],[-0.5307529379620333,53.25394792801467],[-0.5311783786614339,53.25395765549387],[-0.5322307037079653,53.254042493159396],[-0.532714650012353,53.25409427611186],[-0.532962691618701,53.25411619694214],[-0.5336324452729831,53.254166663068396],[-0.5338962741070394,53.254211243745694],[-0.5342972764043871,53.25432140555471],[-0.5344899427095227,53.25433994739241],[-0.5349938746238262,53.25437848531298],[-0.5355532458393095,53.25441500449064],[-0.5363301106100261,53.254448794184285],[-0.5370086339866439,53.25446340004376],[-0.537447056664187,53.25448404853266],[-0.5380169015367239,53.2545215824245],[-0.5382074640953124,53.254518523332635],[-0.5383997335019579,53.25454873671245]]]}}]}
  var organisations = [{"organisation":"local-authority-eng:LIC","wikidata":"Q73072583","name":"City of Lincoln Council","website":"https://www.lincoln.gov.uk","twitter":"","statistical-geography":"E07000138","toid":"","opendatacommunities":"http://opendatacommunities.org/id/district-council/lincoln","opendatacommunities-area":"http://opendatacommunities.org/id/geography/administration/nmd/E07000138","billing-authority":"E2533","census-area":"32UD","local-authority-type":"NMD","esd-inventories":"","start-date":"","end-date":""}]
  var brownfield = [{"entry-date":"2017-09-19","organisation":"local-authority-eng:LIC","site":"2013/1328/F","site-address":"168 Scorer Street","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=497349&y=370308&resolution=0.1&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=Brownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.03","minimum-net-dwellings":"8","maximum-net-dwellings":"8","start-date":"2017-09-19","end-date":"","notes":". Erection of a 3-storey building to accommodate 8 flats","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-09-19","organisation":"local-authority-eng:LIC","site":"2014/0879/F","site-address":"Old Bargate Works, Clumber St","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=497072&y=369008&resolution=0.1&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.04","minimum-net-dwellings":"10","maximum-net-dwellings":"10","start-date":"2017-09-19","end-date":"","notes":". Conversion of existing warehouse to accommodate 10 apartments with associated parking, erection of a three storey extension to rear elevation to facilitate an internal staircase and associated external alterations.","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-09-19","organisation":"local-authority-eng:LIC","site":"2015/0038/F","site-address":"The Victory PH, Boultham Park Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=496604&y=369973&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=Brownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"full planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.27","minimum-net-dwellings":"14","maximum-net-dwellings":"14","start-date":"2017-09-19","end-date":"","notes":". Demolition of public house and garages and erection of three detached buildings comprising 14 dwellings and 4 ground floor commercial units for A2 'Financial and Professional Services' or B1 'Office' purposes (REVISED DESCRIPTION)","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL724","site-address":"Land adjacent to Environment Agency, Waterside North","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=498152&y=371154&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.28","minimum-net-dwellings":"25","maximum-net-dwellings":"25","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL754","site-address":"Car park to west of St. Anne's Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=498568&y=371685&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.38","minimum-net-dwellings":"11","maximum-net-dwellings":"11","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL528","site-address":"Land south of YMCA, Waterside North","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=497980&y=371160&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.39","minimum-net-dwellings":"29","maximum-net-dwellings":"29","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL756","site-address":"Nurses home, Greetwell Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=498682&y=371877&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=Brownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.44","minimum-net-dwellings":"13","maximum-net-dwellings":"13","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL723","site-address":"Surface car park, Waterside North","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=497901&y=371181&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.47","minimum-net-dwellings":"35","maximum-net-dwellings":"35","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"2015/0511/RM","site-address":"Former Boultham Dairy Site","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=496741&y=369988&resolution=0.2&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"outline planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"0.92","minimum-net-dwellings":"14","maximum-net-dwellings":"14","start-date":"2017-09-19","end-date":"","notes":". Erection of a foodstore with access and car parking (FULL PLANNING PERMISSION) and erection of dwellings (OUTLINE) and a place of worship/mosque with car parking or business (B1) use (OUTLINE)","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL813","site-address":"Land East of Urban Street","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=496992&y=368567&resolution=0.5&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=Brownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"1.54","minimum-net-dwellings":"51","maximum-net-dwellings":"51","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL697","site-address":"Land at Usher school, Skellingthorpe Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=495730&y=369332&resolution=0.5&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"2.9","minimum-net-dwellings":"152","maximum-net-dwellings":"152","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL534","site-address":"Land at firth Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=496788&y=370423&resolution=0.5&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"3.63","minimum-net-dwellings":"150","maximum-net-dwellings":"150","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL526","site-address":"Former main hospital complex, St Anne's Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=498714&y=371766&resolution=0.5&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"not permissioned","planning-permission-type":"","hazardous-substances":"","latitude":"","longitude":"","hectares":"3.78","minimum-net-dwellings":"126","maximum-net-dwellings":"126","start-date":"2017-09-19","end-date":"","notes":"","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"},{"entry-date":"2017-11-14","organisation":"local-authority-eng:LIC","site":"CL525","site-address":"Former Cegb power station, Spa Rd","site-plan-url":"https://maps.lincoln.gov.uk/WebMapLayers8/Map.aspx?x=498735&y=371144&resolution=0.5&epsg=27700&mapname=planning&baseLayer=BackgroundMaps&datalayers=BackgroundMaps%2CBrownfield%20Land%20Register%2CselectFeaturesControl_container","deliverable":"yes","ownership":"not owned by a public authority","planning-permission-status":"permissioned","planning-permission-type":"outline planning permission","hazardous-substances":"","latitude":"","longitude":"","hectares":"5.71","minimum-net-dwellings":"300","maximum-net-dwellings":"300","start-date":"2017-09-19","end-date":"","notes":". Residential development with access from Spa Road (Outline)","resource":"a45d01e8f582bde8a6dd5f67d5a253ba6e3f1aabfb55b77ea841d4418f43f481"}]
</script>

<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet.fullscreen@1.6.0/Control.FullScreen.js" crossorigin=""></script>
<script src="https://unpkg.com/leaflet-sidebar@0.2.2/src/L.Control.Sidebar.js" crossorigin=""></script>
<script src="https://unpkg.com/papaparse@5.1.1/papaparse.min.js" crossorigin=""></script>

<script>
var map = L.map('map', {
  preferCanvas: true,
  fullscreenControl: true
}).setView([52.561928, -1.464854], 7)

// Tile layers
L.tileLayer('https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
  id: 'base',
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map)

// Sidebar
var sidebar = L.control.sidebar('sidebar', {
  position: 'right'
})

map.addControl(sidebar)

// Brownfield Features
var brownfieldFeatures = brownfield.map(function (point) {
  return {
    type: 'Feature',
    geometry: {
      type: 'Point',
      coordinates: [point.longitude, point.latitude]
    },
    properties: point
  }
})

// Local authority boundaries (England only)
geoJson = geoJson.features.filter(function (item) {
  return item.properties.lad19cd.startsWith('E')
}).map(function (item) {
  var lad19cd = item.properties.lad19cd
  if (item.properties.lad19cd === 'E06000057') {
    // Northumberland
    lad19cd = 'E06000048'
  } else if (item.properties.lad19cd === 'E07000240') {
    // St Albans
    lad19cd = 'E07000100'
  } else if (item.properties.lad19cd === 'E07000241') {
    // Welwyn Hatfield
    lad19cd = 'E07000104'
  } else if (item.properties.lad19cd === 'E07000242') {
    // East Hertfordshire
    lad19cd = 'E07000097'
  } else if (item.properties.lad19cd === 'E07000243') {
    // Stevenage
    lad19cd = 'E07000101'
  } else if (item.properties.lad19cd === 'E08000037') {
    // Gateshead
    lad19cd = 'E08000020'
  }

  item.properties.organisation = organisations.find(function (organisation) {
    if (organisation['statistical-geography'] && organisation['statistical-geography'].length) {
      return organisation['statistical-geography'].toString().toLowerCase() === lad19cd.toString().toLowerCase()
    }
  })

  return item
})

L.geoJSON(geoJson, {
  style: {
    fillOpacity: 0,
    weight: 2,
    color: 'gray'
  },
  onEachFeature: function (feature, layer) {
    if(organisations.length === 1) {
      map.fitBounds(layer.getBounds())
    }

    if (!feature.properties.organisation) {
      layer.setStyle({
        fillColor: 'red',
        fillOpacity: 0.25
      })
    } else {
      var thisOrganisationsFeatures = brownfieldFeatures.filter(function (brownfieldFeature) {
        if (brownfieldFeature.properties.organisation.toLowerCase() === feature.properties.organisation.organisation.toLowerCase()) {
          return true
        }
        return false
      })

      var brownfieldMarkers = L.markerClusterGroup({
        showCoverageOnHover: false,
        zoomToBoundsOnClick: false,
        spiderfyOnMaxZoom: false,
        removeOutsideVisibleBounds: true,
        animate: false,
        disableClusteringAtZoom: 11,
        maxClusterRadius: 600,
        singleMarkerMode: false
      })
      var brownfieldOnMap = L.geoJSON({
        type: 'FeatureCollection',
        features: thisOrganisationsFeatures
      }, {
        pointToLayer: function (feature, latlng) {
          var size = isNaN(feature.properties.hectares) ? 100 : (Math.sqrt((feature.properties.hectares * 10000) / Math.PI))
          return L.circle(latlng, { color: 'red', fillColor: '#f03', fillOpacity: 0.5, radius: size.toFixed(2) })
        },
        onEachFeature: function (feature, layer) {
          layer.on({
            click: function () {
              sidebar.setContent('<h2>Loading...</h2>')
              sidebar.show()

              return Papa.parse('https://raw.githubusercontent.com/digital-land/map/master/docs/data/brownfield/' + feature.properties.organisation.toLowerCase().replace(':', '-') + '.csv', {
                download: true,
                header: true,
                complete: function (results) {
                  var point = results.data.find(function (row) {
                    return (row.latitude === feature.properties.latitude.toString()) && (row.longitude === feature.properties.longitude.toString())
                  })

                  if (point) {
                    content = ''

                    Object.keys(point).forEach(function (key) {
                      content = content + key + ': ' + point[key] + '<br>'
                    })
                  } else {
                    content = '<h2>Point not found - debug info:</h2><pre>' + JSON.stringify(results.data) + '</pre><h3>Looking for a row with latitude, longitude:</h3>' + feature.properties.latitude.toString() + ',' + feature.properties.longitude.toString()
                  }

                  sidebar.setContent(content)
                }
              })
            }
          })
        }
      })

      brownfieldMarkers.addLayer(brownfieldOnMap)
      map.addLayer(brownfieldMarkers)
    }

    layer.on({
      mouseover: function () {
        this.setStyle({
          fillColor: 'black',
          fillOpacity: 0.25
        })
      },
      mouseout: function () {
        this.setStyle({
          fillColor: 'white',
          fillOpacity: 0
        })
      },
      click: function () {
        return map.fitBounds(layer.getBounds())
      }
    })
  }
}).addTo(map)
</script>
